"use strict";(()=>{var e={};e.id=206,e.ids=[206],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},524:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},6005:e=>{e.exports=require("node:crypto")},1041:e=>{e.exports=require("node:url")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},7285:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>w,requestAsyncStorage:()=>y,routeModule:()=>b,serverHooks:()=>k,staticGenerationAsyncStorage:()=>g});var n={};t.r(n),t.d(n,{GET:()=>d,OPTIONS:()=>h,POST:()=>m});var o=t(5820),s=t(3944),i=t(765),a=t(643),l=t(2458),c=t(7568),p=t(8895),u=t(279);let d=async(e,{params:r})=>{try{let e=await u.Z.seller.findUnique({where:{username:r.username},include:{blink:!0}});if(!e||!e.blinkCreated||!e.blink)return Response.json({message:"User not found"},{headers:a.jS});let t={icon:e.blink.icon,title:e.blink.title,label:e.blink.label,description:e.blink.description,links:{actions:[{href:`/api/actions/${r.username}?navigate=products`,label:"checkout to products"},{href:`/api/actions/${r.username}?navigate=orders`,label:"check your orders"}]}};return Response.json(t,{headers:a.jS})}catch(e){return console.log(e),Response.json(null,{headers:a.jS})}},h=d,m=async(e,{params:r})=>{try{let t;let n=new URL(e.url).searchParams.get("navigate");if(!n)return;let o=await u.Z.seller.findUnique({where:{username:r.username},include:{blink:!0}});if(!o||!o.blinkCreated||!o.blink)return Response.json({message:"User not found"},{headers:a.jS});let s=await e.json();try{t=new c.PublicKey(s.account)}catch(e){return Response.json({message:"Invalid public key"},{headers:a.jS})}console.log("fetch product");let i=await u.Z.product.findMany({where:{sellerId:o.walletAddress}});console.log(i.length);let d=await u.Z.order.findMany({where:{buyerWallet:s.account,orderstatus:"PROCESSING"},include:{product:!0}}),h={type:"inline",action:{icon:"",description:"",label:"",title:"",type:"action",links:{actions:[]}}};"products"==n?h=0==i.length?{type:"inline",action:{type:"completed",icon:"https://imgs.search.brave.com/mTigptQqts4F_6klqySaDOFw3rN35C_WULPGgqdB1Jg/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9tZWRp/YS5nZXR0eWltYWdl/cy5jb20vaWQvMTMy/NjE5NjkyMS9waG90/by9vcGVuZWQtZW1w/dHktY2FyZGJvYXJk/LWJveC1vbi1ncmVl/bi5qcGc_cz02MTJ4/NjEyJnc9MCZrPTIw/JmM9d1k3eUpiZjFB/WDhuLXNMb2lpRHNI/c1pfS2RBRXpGdW40/RWpoczJnQXZhWT0",title:"Products Empty",description:"This Seller is not selling anything .....",label:"nothing to show here"}}:{type:"inline",action:{icon:o.blink.icon,description:o.blink.description,label:o.blink.label,title:o.blink.title,type:"action",links:{actions:[{href:`/api/actions/${r.username}/product/{productId}`,label:"Select Product",parameters:[{type:"select",name:"productId",label:"select the product",options:i.map(e=>({label:`${e.name}`,value:`${e.id}`}))}]}]}}}:"orders"==n&&(h=0==d.length?{type:"inline",action:{type:"completed",icon:"https://imgs.search.brave.com/mTigptQqts4F_6klqySaDOFw3rN35C_WULPGgqdB1Jg/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9tZWRp/YS5nZXR0eWltYWdl/cy5jb20vaWQvMTMy/NjE5NjkyMS9waG90/by9vcGVuZWQtZW1w/dHktY2FyZGJvYXJk/LWJveC1vbi1ncmVl/bi5qcGc_cz02MTJ4/NjEyJnc9MCZrPTIw/JmM9d1k3eUpiZjFB/WDhuLXNMb2lpRHNI/c1pfS2RBRXpGdW40/RWpoczJnQXZhWT0",title:"You dont have any orders",description:"please buy from someones invenotory to check orders",label:"nothing to show here"}}:{type:"inline",action:{icon:o.blink.icon,description:"orders with only processing can be viewed here, and can be cancelled",label:"you can check your processing orders and can cancel them",title:"Check out your orders",type:"action",links:{actions:[{href:`/api/actions/${r.username}/orders/{orderid}`,label:"Select Order",parameters:[{type:"select",name:"orderid",label:"select orders",options:d.map(e=>({label:`${e.product.name}`,value:`${e.id}`}))}]}]}}});let m=(0,p.B)(),b=new c.Transaction;b.add(c.ComputeBudgetProgram.setComputeUnitPrice({microLamports:5}),new c.TransactionInstruction({programId:new c.PublicKey(a.jI),keys:[],data:Buffer.from(n,"utf-8")})),b.feePayer=t,b.recentBlockhash=(await m.getLatestBlockhash()).blockhash,console.log("in here before ceate reposonse");let y=await (0,l.p)({fields:{transaction:b,message:"all good",links:{next:h}}});return console.log("response returned",h),Response.json(y,{headers:a.jS})}catch(e){return console.log("inside error"),Response.json({message:"something went wrong"},{headers:a.jS})}},b=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/actions/[username]/route",pathname:"/api/actions/[username]",filename:"route",bundlePath:"app/api/actions/[username]/route"},resolvedPagePath:"/workspaces/blink-e-commerce/src/app/api/actions/[username]/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:y,staticGenerationAsyncStorage:g,serverHooks:k}=b,v="/api/actions/[username]/route";function w(){return(0,i.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:g})}},279:(e,r,t)=>{t.d(r,{Z:()=>o});var n=t(3524);let o=global.prismaGlobal??new n.PrismaClient},8895:(e,r,t)=>{t.d(r,{B:()=>o});var n=t(7568);let o=()=>new n.Connection(process.env.NEXT_PUBLIC_RPC_END_POINT||(0,n.clusterApiUrl)("devnet"),"confirmed")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[544,744,458],()=>t(7285));module.exports=n})();